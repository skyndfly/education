## Проект: CRM для онлайн-школы
1. Название проекта

EduCRM — система управления онлайн-школой с контролем уроков, финансов и ролей пользователей.

2. Цель проекта

Создать систему, которая позволяет:

Менеджерам создавать учеников и назначать им учителей и курсы.

Ученикам пополнять баланс и участвовать в уроках.

Учителям отмечать проведенные уроки, заполнять тему, комментарий и домашнее задание.

Автоматически списывать средства с учеников и начислять заработок учителям и школе.

Владельцу школы отслеживать финансовые показатели и отчеты.

3. Роли пользователей
   - Роль	Возможности
   - Manager	Создание аккаунтов учеников, назначение учителей и курсов, смена учителя/курса
   - Student	Пополнение баланса, просмотр своих уроков и оплат
   - Teacher	Отмечает урок проведенным, заполняет тему, комментарий, домашнее задание; видит баланс и может вывести средства после ≥10 уроков
   - Owner	Просмотр всех финансовых отчетов: доход школы, заработок учителей, статистика менеджеров
4. Основные сущности и таблицы

    - users – все пользователи (ученики, менеджеры, учителя, владелец)

   - courses – курсы / предметы

   - assignments – привязка учителя и курса к ученику

   - balances – баланс каждого пользователя

   - lessons – информация о проведенных уроках

   - transactions – финансовые операции (списание ученика, зачисление учителю, доход школы)

5. Основная логика работы

   1. Менеджер: создает ученика → назначает учителя и курс → управляет сменой учителя.
   2. Ученик: пополняет баланс → участвует в уроках.
   3. Учитель: отмечает урок как проведенный, заполняет тему/комментарий/домашнее задание → списываются деньги с ученика, начисляется ставка учителю, остаток идет школе.
   4. Школа / Владелец: видит доход школы, отчеты по учителям, менеджерам и курсам.

### Финансовая логика:
- Стоимость урока: 1200 руб
- Ставка учителя: 500 руб
- Доход школы: 700 руб

Вывод средств учителем возможен только после проведения минимум 10 уроков

6. REST API (основные эндпоинты)
Endpoint	Method	Роль	Описание
`/student/create`	`POST`	Manager	Создает нового ученика <br>

`/assignment/assign`	`POST`	Manager	Назначает учителя и курс <br>
`/balance/topup`	`POST`	Student	Пополнение баланса ученика<br>
`/lesson/complete`	`POST`	Teacher	Отмечает урок проведенным, добавляет тему, комментарий, домашнее задание<br>
`/teacher/withdraw`	`POST`	Teacher	Вывод средств после ≥10 уроков<br>
`/report/school-income`	`GET`	Owner	Отчеты по доходу школы, учителям, менеджерам<br>
7. Пошаговое развитие проекта
Этап	Описание
   1. Создание таблиц, ролей, базовый CRUD через Query Builder
   2. REST API для менеджера (создание учеников, назначение учителя/курса)
   3. Пополнение баланса учеником
   4. Учитель отмечает урок → транзакции списания/зачисления средств
   5. Отчеты для владельца школы
   6. Вывод средств учителем после 10 уроков
   7. Фильтры, пагинация, отчеты за период
   8. Оптимизация SQL-запросов, индексы, кэширование (Redis)
8. Технологическая архитектура

Yii2 REST API без ActiveRecord

Query Builder и SQL для работы с базой

DTO / Репозитории для отделения бизнес-логики от SQL

PostgreSQL как СУБД

Redis для кэширования тяжелых запросов (опционально)

JWT или OAuth2 для аутентификации пользователей

## Разработка

Статический анализ
```bash
 vendor/bin/phpstan analyse
```
